---
title: "Lowess"
---

```{r}
set.seed(1)

X <- seq(1,100)
e <- rnorm(100, 0, (0.2)**2)
Y <- sin(X/10) + e

custom_lowess <- function(x,y,f){
  
  n <- length(y)
  x <- matrix(data = cbind(rep(1,n), x), nrow = n , ncol = 2)
  k <- floor(f*n)
  w <- rep(NA, n)
  yhat <- rep(NA,n)
  
  for(i in 1:n)
    {
    dists <- abs(rep(x[i,2],n) - x[,2])
    dmax <- sort(dists)[k]
  
    
    for(j in 1:n){
      if((abs(x[j,2] - x[i,2]) > dmax)){
        w[j] <- 0
      }
      else{
        w[j] <- (1 - (abs(x[j,2]-x[i,2])/dmax)**3)**3
      }
    }
  
  
   W <- diag(x = w, nrow = n, ncol = n)
   Beta <- solve(t(x)%*%W%*%x)%*%t(x)%*%W%*%y
   yhat[i] <- Beta[1] + Beta[2]*x[i,2]
  }
  return(yhat)
}

round(custom_lowess(X,Y,0.5),5) == round(lowess(X,Y,f = 0.5, iter = 0)$y, 5)



```
